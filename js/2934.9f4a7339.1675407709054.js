"use strict";(self["webpackChunkpolkaswap_exchange_web"]=self["webpackChunkpolkaswap_exchange_web"]||[]).push([[2934],{52934:function(e,t,s){s.r(t),s.d(t,{default:function(){return X}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.parentLoading,expression:"parentLoading"}],staticClass:"container container--charts"},[s("div",{staticClass:"tokens-info-container"},[s("div",{staticClass:"header"},[s("div",{staticClass:"selected-tokens"},[s("tokens-row",{attrs:{border:"",assets:e.tokens,size:"medium"}}),e.tokenA?s("div",{staticClass:"token-title"},[s("span",[e._v(e._s(e.tokenA.symbol))]),e.tokenB?s("span",[e._v("/"+e._s(e.tokenB.symbol))]):e._e()]):e._e(),this.tokensPair?s("s-button",{class:{"s-pressed":e.isReversedChart},attrs:{type:"action",alternative:"",icon:"arrows-swap-90-24"},on:{click:e.revertChart}}):e._e()],1),s("div",{staticClass:"chart-filters"},[s("s-tabs",{attrs:{type:"rounded",value:e.selectedFilter.name},on:{input:e.selectFilter}},e._l(e.filters,(function(t){return s("s-tab",{key:t.name,attrs:{name:t.name,label:t.label,disabled:e.parentLoading||e.loading}})})),1)],1),s("div",{staticClass:"s-flex chart-types"},e._l(e.chartTypeButtons,(function(t){var i=t.type,r=t.icon,a=t.active;return s("svg-icon-button",{key:i,attrs:{icon:r,active:a,disabled:e.parentLoading||e.loading,size:"small"},on:{click:function(t){return e.selectChartType(i)}}})})),1)])]),s("s-skeleton",{attrs:{loading:e.parentLoading||e.loading||e.chartDataIssue,throttle:0},scopedSlots:e._u([{key:"template",fn:function(){return[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"charts-skeleton"},[s("s-skeleton-item",{staticClass:"charts-skeleton-price",attrs:{element:"rect"}}),s("div",{staticClass:"charts-skeleton-price-impact"},[s("s-skeleton-item",{attrs:{element:"circle"}}),s("s-skeleton-item",{attrs:{element:"rect"}})],1),e._l(9,(function(e){return s("div",{key:e,staticClass:"charts-skeleton-line"},[s("s-skeleton-item",{staticClass:"charts-skeleton-label",attrs:{element:"rect"}}),s("s-skeleton-item",{staticClass:"charts-skeleton-border",attrs:{element:"rect"}})],1)})),s("div",{staticClass:"charts-skeleton-line charts-skeleton-line--lables"},e._l(11,(function(e){return s("s-skeleton-item",{key:e,staticClass:"charts-skeleton-label",attrs:{element:"rect"}})})),1),e.chartDataIssue?s("div",{staticClass:"charts-skeleton-error"},[e.isFetchingError?s("s-icon",{attrs:{name:"clear-X-16",size:"32px"}}):e._e(),s("p",{staticClass:"charts-skeleton-error-message"},[e.isFetchingError?[e._v(e._s(e.t("swap.errorFetching")))]:[e._v(e._s(e.t("noDataText")))]],2),e.isFetchingError?s("s-button",{staticClass:"el-button--select-token",attrs:{type:"secondary",size:"small"},on:{click:e.updatePrices}},[e._v(" "+e._s(e.t("retryText"))+" ")]):e._e()],1):e._e()],2)]},proxy:!0}])},[[s("div",{staticClass:"charts-price"},[s("formatted-amount",{attrs:{value:e.fiatPriceFormatted,"font-weight-rate":e.FontWeightRate.MEDIUM,"font-size-rate":e.FontWeightRate.MEDIUM,"asset-symbol":e.symbol,"symbol-as-decimal":""}})],1),e.isFetchingError?e._e():s("price-change",{attrs:{value:e.priceChange}}),s("v-chart",{ref:"chart",staticClass:"chart",attrs:{option:e.chartSpec,autoresize:""},on:{"zr:mousewheel":e.handleZoom,datazoom:e.changeZoomLevel}})]],2)],1)},r=[],a=s(60760),o=s(70655),n=s(27484),c=s.n(n),h=s(25387),l=s.n(h),m=s(52151),p=s.n(m),d=s(26027),u=s(53545),g=s(36930),f=s(68925),y=s(58665),b=s(37365),k=s(74614),F=s(85530);let T=class extends u.w3{constructor(...e){super(...e),(0,a.Z)(this,"libraryTheme",void 0)}get theme(){const e=this.libraryTheme,t={color:{theme:{accent:(0,F.y_)("--s-color-theme-accent"),accentHover:(0,F.y_)("--s-color-theme-accent-hover")},base:{content:{primary:(0,F.y_)("--s-color-base-content-primary"),secondary:(0,F.y_)("--s-color-base-content-secondary"),tertiary:(0,F.y_)("--s-color-base-content-tertiary")},border:{secondary:(0,F.y_)("--s-color-base-border-secondary")},onAccent:(0,F.y_)("--s-color-base-on-accent")},utility:{body:(0,F.y_)("--s-color-utility-body")},status:{success:(0,F.y_)("--s-color-status-success"),error:(0,F.y_)("--s-color-status-error")}},border:{radius:{mini:(0,F.y_)("--s-border-radius-mini")}},shadow:{dialog:(0,F.y_)("--s-shadow-dialog")}};return!!e&&t}};(0,o.__decorate)([k.Yn.libraryTheme],T.prototype,"libraryTheme",void 0),T=(0,o.__decorate)([u.wA],T);var v,A,C=T,S=s(32806),P=s(64568),_=s(80710),E=s(16546),U=s(25108);(function(e){e["FIVE_MINUTES"]="FIVE_MINUTES",e["FIFTEEN_MINUTES"]="FIFTEEN_MINUTES",e["THIRTY_MINUTES"]="THIRTY_MINUTES",e["HOUR"]="HOUR",e["FOUR_HOURS"]="FOUR_HOURS",e["DAY"]="DAY",e["WEEK"]="WEEK",e["MONTH"]="MONTH",e["YEAR"]="YEAR",e["ALL"]="ALL"})(v||(v={})),function(e){e["LINE"]="line",e["CANDLE"]="candlestick"}(A||(A={}));const x={[A.LINE]:P.a.LineIcon,[A.CANDLE]:P.a.CandleIcon},w={[b.OY.AssetSnapshotTypes.DEFAULT]:3e5,[b.OY.AssetSnapshotTypes.HOUR]:36e5,[b.OY.AssetSnapshotTypes.DAY]:864e5},L=[{name:v.DAY,label:"1D",type:b.OY.AssetSnapshotTypes.DEFAULT,count:288},{name:v.WEEK,label:"1W",type:b.OY.AssetSnapshotTypes.HOUR,count:168},{name:v.MONTH,label:"1M",type:b.OY.AssetSnapshotTypes.DAY,count:30},{name:v.YEAR,label:"1Y",type:b.OY.AssetSnapshotTypes.DAY,count:365},{name:v.ALL,label:"ALL",type:b.OY.AssetSnapshotTypes.DAY,count:1/0}],I=[{name:v.FIVE_MINUTES,label:"5m",type:b.OY.AssetSnapshotTypes.DEFAULT,count:48},{name:v.FIFTEEN_MINUTES,label:"15m",type:b.OY.AssetSnapshotTypes.DEFAULT,count:144,group:3},{name:v.THIRTY_MINUTES,label:"30m",type:b.OY.AssetSnapshotTypes.DEFAULT,count:288,group:6},{name:v.HOUR,label:"1h",type:b.OY.AssetSnapshotTypes.HOUR,count:24},{name:v.FOUR_HOURS,label:"4h",type:b.OY.AssetSnapshotTypes.HOUR,count:96,group:4},{name:v.DAY,label:"1D",type:b.OY.AssetSnapshotTypes.DAY,count:90}],N=4,D=8,O={fontFamily:"Sora",fontSize:10,fontWeight:300,lineHeigth:1.5},R=6e3,M=e=>(t,s,i)=>g.FPNumber.gt(e,g.FPNumber.ZERO)?t:g.FPNumber.lt(e,g.FPNumber.ZERO)?s:i,Z=e=>{const t=M(e)("+","",""),s=(0,F.Gc)(e,!0);return`${t}${s}`},Y=(e,t)=>`${new g.FPNumber(e).toLocaleString()} ${t}`,z=e=>{const{open:t,close:s,low:i,high:r}=e.priceUSD;return[+t,+s,+i,+r]},H=(e,t)=>0!==t?e/t:0,W=(e,t)=>e.map(((e,s)=>H(e,t[s]))),B=e=>{const t=1e3*+e.timestamp,s=z(e);return{timestamp:t,price:s}},$=(e,t,s)=>{const i=[];for(const r of e){const e=[],a=p()(i)?.timestamp??s;let o=r.timestamp;while((o+=t)<a)e.push({timestamp:o,price:[r.price[1],r.price[1],r.price[1],r.price[1]]});i.push(...e.reverse(),r)}return i},j=e=>{let t=2;if(0===e||!Number.isFinite(e))return t;while(Math.floor(e)<=0)e*=10,t++;return t};let V=class extends((0,u.Wr)(S.Z,C,b.tA.LoadingMixin,b.tA.NumberFormatterMixin,b.tA.FormattedAmountMixin)){constructor(...e){super(...e),(0,a.Z)(this,"tokenFrom",void 0),(0,a.Z)(this,"tokenTo",void 0),(0,a.Z)(this,"isAvailable",void 0),(0,a.Z)(this,"isFetchingError",!1),(0,a.Z)(this,"FontWeightRate",b.it.FontWeightRate),(0,a.Z)(this,"samplesBuffer",{}),(0,a.Z)(this,"pageInfos",{}),(0,a.Z)(this,"prices",[]),(0,a.Z)(this,"zoomStart",0),(0,a.Z)(this,"zoomEnd",100),(0,a.Z)(this,"precision",2),(0,a.Z)(this,"limits",{min:1/0,max:0}),(0,a.Z)(this,"updatePrices",(0,F._1)(this.getHistoricalPrices,250,{leading:!1})),(0,a.Z)(this,"forceUpdatePrices",(0,F._1)(this.resetAndUpdatePrices,250,{leading:!1})),(0,a.Z)(this,"priceUpdateRequestId",0),(0,a.Z)(this,"priceUpdateWatcher",null),(0,a.Z)(this,"priceUpdateTimestampSync",null),(0,a.Z)(this,"chartType",A.LINE),(0,a.Z)(this,"selectedFilter",L[0]),(0,a.Z)(this,"isReversedChart",!1)}handleTokensChange(e,t){if(!l()(e)(t)){const s=this.isReversedChart?[...t].reverse():t;this.isReversedChart=!1,l()(e)(s)||this.forceUpdatePrices()}}get isLineChart(){return this.chartType===A.LINE}get inputTokensAddresses(){const e=[this.tokenFrom,this.tokenTo].filter((e=>!!e));return e.map((e=>e.address))}get tokenA(){return this.isReversedChart?this.tokenTo:this.tokenFrom}get tokenB(){return this.isReversedChart?this.tokenFrom:this.tokenTo}get tokens(){return[this.tokenA,this.tokenB].filter((e=>!!e))}get tokensAddresses(){return this.tokens.map((e=>e.address))}get tokensPair(){return 2===this.tokensAddresses.length}get chartTypeButtons(){return Object.values(A).map((e=>({type:e,icon:x[e],active:this.chartType===e})))}get filters(){return this.isLineChart?L:I}get symbol(){return this.tokenB?.symbol??"USD"}get fromFiatPrice(){return this.tokenA?g.FPNumber.fromCodecValue(this.getAssetFiatPrice(this.tokenA)??0):g.FPNumber.ZERO}get toFiatPrice(){return this.tokenB?g.FPNumber.fromCodecValue(this.getAssetFiatPrice(this.tokenB)??0):g.FPNumber.ZERO}get fiatPrice(){return this.toFiatPrice.isZero()?this.fromFiatPrice:this.fromFiatPrice.div(this.toFiatPrice)}get fiatPriceFormatted(){return this.fiatPrice.toLocaleString()}get isAllHistoricalPricesFetched(){return Object.entries(this.pageInfos).some((([e,t])=>!t.hasNextPage&&!this.samplesBuffer[e]?.length))}get timeDifference(){return w[this.selectedFilter.type]}get visibleChartItemsRange(){const e=this.chartData.length,t=Math.floor(e*this.zoomStart/100),s=Math.ceil(e*this.zoomEnd/100)-1;return[t,s]}get priceChange(){const[e,t]=this.visibleChartItemsRange,s=new g.FPNumber(this.chartData[e]?.[2]??0),i=new g.FPNumber(this.chartData[t]?.[2]??0);return(0,F._Q)(i,s)}get gridLeftOffset(){const e=10*this.limits.max,t=(0,F.mY)(String(e.toFixed(this.precision)),O.fontFamily,O.fontSize);return D+2*N+t}get chartData(){const e=[],{prices:t,selectedFilter:{group:s}}=this,i=t.slice().reverse();for(let r=0;r<i.length;r++)if(s&&r%s!==0){const t=p()(e);t&&(t[2]=i[r].price[1],t[3]=Math.min(t[3],i[r].price[2]),t[4]=Math.max(t[4],i[r].price[3]))}else e.push([i[r].timestamp,...i[r].price]);return Object.freeze(e)}get chartDataIssue(){return!this.loading&&(this.isFetchingError||0===this.chartData.length)}get chartOptionSeries(){return this.isLineChart?[{type:"line",encode:{y:"close"},showSymbol:!1,areaStyle:{opacity:.8,color:new d.Q.o(0,0,0,1,[{offset:0,color:"rgba(248, 8, 123, 0.25)"},{offset:1,color:"rgba(255, 49, 148, 0.03)"}])}}]:[{type:"candlestick",barMaxWidth:10,itemStyle:{color:this.theme.color.status.success,borderColor:this.theme.color.status.success,color0:this.theme.color.theme.accentHover,borderColor0:this.theme.color.theme.accentHover,borderWidth:2}}]}get chartSpec(){return{dataset:{source:this.chartData,dimensions:["timestamp","open","close","low","high"]},grid:{left:this.gridLeftOffset,right:0,bottom:20+D,top:20},xAxis:{offset:D,type:"time",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{formatter:e=>{const t=c()(+e),s=0===t.hour()&&0===t.minute(),i=1===t.date()&&s,r=i?"MMMM":s?"D":"HH:mm",a=this.formatDate(+e,r);return i?`{monthStyle|${a.charAt(0).toUpperCase()+a.slice(1)}}`:s?`{dateStyle|${a}}`:a},rich:{monthStyle:{fontSize:10,fontWeight:"bold"},dateStyle:{fontSize:10,fontWeight:"bold"}},color:this.theme.color.base.content.secondary,...O},axisPointer:{lineStyle:{color:this.theme.color.status.success},label:{backgroundColor:this.theme.color.status.success,color:this.theme.color.base.onAccent,fontSize:11,fontWeight:400,lineHeigth:1.5,margin:0,formatter:({value:e})=>this.formatDate(+e,"LLL")}},boundaryGap:!this.isLineChart&&[.005,.005]},yAxis:{type:"value",offset:D,scale:!0,axisLabel:{...O,margin:0,padding:N-1,formatter:e=>e.toFixed(this.precision)},axisLine:{lineStyle:{color:this.theme.color.base.content.secondary}},axisPointer:{lineStyle:{color:this.theme.color.status.success},label:{...O,backgroundColor:this.theme.color.status.success,fontWeight:400,padding:[N,N],precision:this.precision,color:this.theme.color.base.onAccent}},splitLine:{lineStyle:{color:this.theme.color.base.content.tertiary}}},dataZoom:[{type:"inside",start:0,end:100,minValueSpan:11*this.timeDifference}],color:[this.theme.color.theme.accent,this.theme.color.status.success],tooltip:{show:!0,trigger:"axis",axisPointer:{type:"cross"},backgroundColor:this.theme.color.utility.body,borderColor:this.theme.color.base.border.secondary,extraCssText:`box-shadow: ${this.theme.shadow.dialog}; border-radius: ${this.theme.border.radius.mini}`,textStyle:{color:this.theme.color.base.content.secondary,fontSize:11,fontFamily:"Sora",fontWeight:400},formatter:e=>{const{data:t,seriesType:s}=e[0],[i,r,a,o,n]=t;if(s===A.LINE)return Y(a,this.symbol);if(s===A.CANDLE){const e=(0,F._Q)(new g.FPNumber(a),new g.FPNumber(r)),t=M(e)(this.theme.color.status.success,this.theme.color.status.error,this.theme.color.base.content.primary),s=[{title:"Open",data:Y(r,this.symbol)},{title:"High",data:Y(n,this.symbol)},{title:"Low",data:Y(o,this.symbol)},{title:"Close",data:Y(a,this.symbol)},{title:"Change",data:Z(e),color:t}];return`\n              <table>\n                ${s.map((e=>`\n                  <tr>\n                    <td align="right" style="color:${this.theme.color.base.content.secondary}">${e.title}</td>\n                    <td style="color:${e.color??this.theme.color.base.content.primary}">${e.data}</td>\n                  </tr>\n                `)).join("")}\n              </table>\n            `}}},series:this.chartOptionSeries}}created(){this.forceUpdatePrices()}beforeDestroy(){this.unsubscribeFromPriceUpdates()}async fetchData(e){const{type:t,count:s}=this.selectedFilter,i=this.pageInfos[e],r=this.samplesBuffer[e]??[],a=[];let o=i?.hasNextPage??!0,n=i?.endCursor??"";if(r.length>=s)return{nodes:a,hasNextPage:o,endCursor:n};let c=s;do{const s=Math.min(c,100),i=await b.m5.price.getHistoricalPriceForAsset(e,t,s,n);if(!i)throw new Error("Chart data fetch error");o=i.pageInfo.hasNextPage,n=i.pageInfo.endCursor,a.push(...i.nodes),c-=i.nodes.length}while(o&&c>0);return{nodes:a,hasNextPage:o,endCursor:n}}getUpdatedPrecision(e,t){return Math.max(j(e),j(t))}async getHistoricalPrices(){if(this.loading||this.isAllHistoricalPricesFetched)return;if(this.tokensPair&&!this.isAvailable)return;const e=[...this.tokensAddresses],t=Date.now(),s=p()(this.prices)?.timestamp??Date.now();this.priceUpdateRequestId=t,await this.withApi((async()=>{try{const i=await Promise.all(e.map((e=>this.fetchData(e))));if(!(i&&l()(e)(this.tokensAddresses)&&l()(t)(this.priceUpdateRequestId)))return;const r={},a=[],o=[],n=s??1e3*Math.max(i[0]?.nodes[0]?.timestamp??0,i[1]?.nodes[0]?.timestamp??0);i.forEach((({hasNextPage:t,endCursor:s,nodes:i},a)=>{const c=e[a],h=i.map((e=>B(e))),l=this.samplesBuffer[c]??[],m=$(l.concat(h),this.timeDifference,n);o.push(m),r[c]={hasNextPage:t,endCursor:s}}));const c=Math.min(o[0]?.length??1/0,o[1]?.length??1/0,this.selectedFilter.count);let{min:h,max:m}=this.limits;for(let e=0;e<c;e++){const t=o[0]?.[e],s=o[1]?.[e],i=t?.timestamp??s?.timestamp,r=s?.price&&t?.price?W(t.price,s.price):t?.price??[0,0,0,0];if(0===r[0]&&0===r[1])break;a.push({timestamp:i,price:r}),h=Math.min(h,...r),m=Math.max(m,...r)}e.forEach(((e,t)=>{this.samplesBuffer[e]=Object.freeze(o[t].slice(c))})),this.limits={min:h,max:m},this.pageInfos=r,this.precision=this.getUpdatedPrecision(h,m),this.updatePricesCollection([...this.prices,...a]),this.isFetchingError=!1}catch(i){this.isFetchingError=!0,U.error(i)}}))}unsubscribeFromPriceUpdates(){this.priceUpdateWatcher&&this.priceUpdateWatcher(),this.priceUpdateTimestampSync&&clearInterval(this.priceUpdateTimestampSync),this.priceUpdateWatcher=null,this.priceUpdateTimestampSync=null}subscribeToPriceUpdates(){this.unsubscribeFromPriceUpdates();const e=[...this.tokensAddresses];this.priceUpdateWatcher=this.$watch((()=>this.fiatPriceObject),((t,s)=>{!t||s&&!e.some((e=>t[e]!==s[e]))||this.handlePriceUpdates(e,t)})),this.priceUpdateTimestampSync=setInterval((()=>this.handlePriceTimestampSync(e)),R)}getCurrentSnapshotTimestamp(){const e=Math.floor(Date.now()/1e3),t=this.timeDifference/1e3,s=Math.floor(e/t),i=t*s*1e3;return i}handlePriceTimestampSync(e){if(!l()(e)(this.tokensAddresses))return;const t=this.getCurrentSnapshotTimestamp(),s=this.prices[0];if(!s||t===s.timestamp)return;const i=s.price[1],r=[i,i,i,i],a={timestamp:t,price:r};this.updatePricesCollection([a,...this.prices])}handlePriceUpdates(e,t){if(!l()(e)(this.tokensAddresses))return;const s=this.getCurrentSnapshotTimestamp(),i=this.prices[0],[r,a]=this.tokensAddresses.map((e=>g.FPNumber.fromCodecValue(t[e]??0).toNumber())),o=Number.isFinite(a)?H(r,a):r,n=Math.min(this.limits.min,o),c=Math.max(this.limits.max,o),h=i?.price?.[0]??o,m=i?.price?.[2]??o,p=i?.price?.[3]??o,d=i?.timestamp===s,u=[d?h:o,o,Math.min(m,o),Math.max(p,o)],f={timestamp:s,price:u},y=[...this.prices];d&&y.shift(),y.unshift(f),this.precision=this.getUpdatedPrecision(n,c),this.limits={min:n,max:c},this.updatePricesCollection(y)}clearData(e=!1){this.samplesBuffer={},this.pageInfos={},this.prices=[],this.zoomStart=0,this.zoomEnd=100,this.limits={min:1/0,max:0},this.precision=2,e||(this.isReversedChart=!1)}updatePricesCollection(e){this.prices=Object.freeze(e)}changeFilter(e){this.selectedFilter=e,this.forceUpdatePrices(!0)}async resetAndUpdatePrices(e=!1){this.clearData(e),await this.updatePrices(),this.subscribeToPriceUpdates()}selectFilter(e){const t=this.filters.find((t=>t.name===e));t&&this.changeFilter(t)}selectChartType(e){this.chartType=e,this.changeFilter(this.filters[0])}handleZoom(e){e?.stop?.(),e?.wheelDelta<0&&0===this.zoomStart&&100===this.zoomEnd&&this.updatePrices()}changeZoomLevel(e){const t=e?.batch?.[0];this.zoomStart=t?.start??0,this.zoomEnd=t?.end??0}revertChart(){this.isReversedChart=!this.isReversedChart,this.forceUpdatePrices(!0)}};(0,o.__decorate)([(0,u.fI)({default:()=>null,type:Object})],V.prototype,"tokenFrom",void 0),(0,o.__decorate)([(0,u.fI)({default:()=>null,type:Object})],V.prototype,"tokenTo",void 0),(0,o.__decorate)([(0,u.fI)({default:!1,type:Boolean})],V.prototype,"isAvailable",void 0),(0,o.__decorate)([(0,u.RL)("inputTokensAddresses")],V.prototype,"handleTokensChange",null),V=(0,o.__decorate)([(0,u.wA)({components:{TokenLogo:b.wx.TokenLogo,FormattedAmount:b.wx.FormattedAmount,SvgIconButton:(0,_.kF)(E.z8.SvgIconButton),TokensRow:(0,_.kF)(E.z8.TokensRow),PriceChange:(0,_.kF)(E.z8.PriceChange),SSkeleton:f.s,SSkeletonItem:y.L}})],V);var q=V,K=q,Q=s(1001),G=(0,Q.Z)(K,i,r,!1,null,"1f76a096",null),X=G.exports}}]);